---
import type { CollectionEntry } from 'astro:content';
import { formatDate } from '../../utils';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const tags = post.data.tags || [];
const isDraft = post.data.draft;
---

<li class={`card bg-base-200 hover:bg-base-300 transition-colors duration-300 shadow-sm hover:shadow-md relative group ${isDraft ? 'opacity-70 border-2 border-warning border-dashed' : ''}`}>
  
  {/* FIX: Use 'div' instead of 'a' for the wrapper. 
      Nesting <a> inside <a> destroys the layout. 
  */}
  <div class="card-body p-6">
    
<h3 class="card-title text-2xl font-bold text-primary group-hover:underline decoration-2 underline-offset-4">
      <a href={`/blog/${post.id}/`} class="before:absolute before:inset-0 focus:outline-none">
        <span transition:name={`title-${post.id}`}>
          {post.data.title}
        </span>
      </a>
      
      {/* Draft Badge inside Title */}
      {isDraft && <span class="badge badge-warning font-mono text-xs z-20 relative">DRAFT</span>}
    </h3>

    <div class="flex flex-wrap items-center gap-y-2 gap-x-4 text-sm text-base-content/60 mb-2 relative z-10">
      <time datetime={post.data.pubDate.toISOString()}>
        {formatDate(post.data.pubDate)}
      </time>

      {/* TAGS: 
          'relative z-10' is CRITICAL here. 
          It ensures these buttons sit physically ON TOP of the 'stretched link' layer created above.
          Without this, clicking a tag would open the article instead.
      */}
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.map((tag) => (
            <a 
              href={`/tags/${tag}`} 
              class="badge badge-sm badge-outline opacity-75 hover:opacity-100 hover:badge-primary hover:scale-105 transition-all cursor-pointer no-underline"
            >
              #{tag}
            </a>
          ))}
        </div>
      )}
    </div>

    <p class="text-base-content/80 line-clamp-3 mb-4">
      {post.data.description}
    </p>
    
    <div class="card-actions justify-end mt-auto pointer-events-none">
      <span class="btn btn-sm btn-outline btn-primary group-hover:btn-active">Read Article</span>
    </div>

  </div>
</li>
