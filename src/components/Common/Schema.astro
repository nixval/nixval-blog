---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

// 1. Construct Absolute URLs (Google requires absolute links)
const canonicalUrl = new URL(Astro.url.pathname, Astro.site);
const heroImageUrl = post.data.heroImage 
  ? (typeof post.data.heroImage === 'string' 
      ? (post.data.heroImage.startsWith('http') ? post.data.heroImage : new URL(post.data.heroImage, Astro.site))
      : new URL(post.data.heroImage.src, Astro.site))
  : new URL('/og.png', Astro.site); // Fallback image

// 2. Define the Schema Object
const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "image": heroImageUrl.toString(),
  "datePublished": post.data.pubDate.toISOString(),
  "dateModified": (post.data.updatedDate || post.data.pubDate).toISOString(),
  "author": {
    "@type": "Person",
    "name": "NixVal", // REPLACE WITH YOUR NAME
    "url": Astro.site
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl.toString()
  },
  // Keywords help Google understand the topic
  "keywords": post.data.tags?.join(", ") || ""
};
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
