---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from './BaseLayout.astro';
import { formatDate } from '../utils';
import CopyCodeButton from '../components/Blog/CopyCodeButton.astro'; 
interface Props {
  title: string;
  description: string;
  pubDate?: Date | string; 
  updatedDate?: Date | string;
  heroImage?: any;
}

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// Helper Dates
let pubDateObj: Date | null = null;
let updatedDateObj: Date | null = null;

try {
  if (pubDate) {
    pubDateObj = new Date(pubDate);
    if (isNaN(pubDateObj.getTime())) pubDateObj = null;
  }
  if (updatedDate) {
    updatedDateObj = new Date(updatedDate);
    if (isNaN(updatedDateObj.getTime())) updatedDateObj = null;
  }
} catch (e) {
  console.error(`[BlogPostLayout] Error parsing dates:`, e);
}
---

<BaseLayout title={title} description={description}>
  <article class="max-w-4xl mx-auto">
    {heroImage && (
      <div class="mb-8 rounded-box overflow-hidden shadow-xl aspect-video relative">
        {typeof heroImage === 'object' ? (
          <Image 
            src={heroImage} 
            alt={title} 
            class="object-cover w-full h-full"
          />
        ) : (
          <img 
            src={heroImage} 
            alt={title} 
            class="object-cover w-full h-full"
          />
        )}
      </div>
    )}

    <header class="mb-10 text-center">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4">{title}</h1>
      
      {pubDateObj && (
        <div class="text-base-content/60 flex items-center justify-center gap-4 text-sm">
          <time datetime={pubDateObj.toISOString()}>{formatDate(pubDateObj)}</time>
          {updatedDateObj && (
            <div class="italic">
              (Updated: <time datetime={updatedDateObj.toISOString()}>{formatDate(updatedDateObj)}</time>)
            </div>
          )}
        </div>
      )}
      
      <hr class="border-base-content/10 mt-8" />
    </header>

    <div class="prose prose-lg max-w-none prose-headings:font-bold prose-a:text-primary hover:prose-a:text-primary-focus">
      <slot />
    </div>
<CopyCodeButton />
    <hr class="border-base-content/10 my-8" />
    <slot name="comments" /> 
  </article>
</BaseLayout>
