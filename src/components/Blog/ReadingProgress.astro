---
// src/components/Blog/ReadingProgress.astro
---

<div id="reading-progress-container" class="fixed top-0 left-0 w-full h-1 z-50 bg-transparent pointer-events-none">
  <div 
    id="reading-progress-bar" 
    class="h-full bg-primary w-0 transition-all duration-100 ease-out shadow-[0_0_10px_rgba(var(--p),0.7)]"
  ></div>
</div>

<script>
  function updateProgressBar() {
    const bar = document.getElementById('reading-progress-bar');
    if (!bar) return;

    const updateProgress = () => {
      // Calculate how far down the user has scrolled
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      
      // Prevent division by zero
      if (scrollHeight <= 0) {
        bar.style.width = '0%';
        return;
      }

      const scrolled = (scrollTop / scrollHeight) * 100;
      bar.style.width = `${scrolled}%`;
    };
    updateProgress();
  }

  if (!document.documentElement.dataset.readingProgressBound) {
    window.addEventListener('scroll', updateProgressBar, { passive: true });
    document.addEventListener('astro:page-load', updateProgressBar);
    document.documentElement.dataset.readingProgressBound = 'true';
  }

  updateProgressBar();
</script>
